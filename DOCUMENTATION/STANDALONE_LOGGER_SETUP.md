# Standalone Aviator Round Logger - Setup & Usage Guide

Complete guide for running the standalone OCR round logger on your Google VM.

## Overview

The `standalone_round_logger.py` script:
- âœ… Captures Aviator game screen region via OCR
- âœ… Reads multipliers in real-time
- âœ… Detects round completion automatically
- âœ… Logs peak multiplier to Supabase database
- âœ… Runs continuously on a separate process

**Table:** `AviatorRound` (roundId, multiplier, timestamp)

---

## Requirements

### 1. System Requirements

- **Windows/Linux/macOS** with Aviator game running
- **Python 3.8+** installed
- **Tesseract OCR** installed on system
- **Screen capture:** Game must be visible on screen

### 2. Python Dependencies

All required packages are already in `requirements.txt`:

```
pytesseract==0.3.10
opencv-python==4.8.1.78
mss==9.0.1
pillow==10.0.1
psycopg2-binary==2.9.9
python-dotenv==1.0.0
numpy>=1.24.3
```

### 3. Tesseract Installation

**Windows:**
1. Download installer from: https://github.com/UB-Mannheim/tesseract/wiki
2. Run: `tesseract-ocr-w64-setup-v5.x.x.exe`
3. Install to default path: `C:\Program Files\Tesseract-OCR\`
4. Script will auto-detect this path

**Linux (Ubuntu/Debian):**
```bash
sudo apt-get install tesseract-ocr
```

**macOS:**
```bash
brew install tesseract
```

### 4. Environment Variables

Your `.env` file should already exist with:

```env
DB_HOST=zofojiubrykbtmstfhzx.supabase.co
DB_PORT=5432
DB_NAME=postgres
DB_USER=postgres
DB_PASSWORD=your_supabase_password
```

If `.env` is missing:
1. Copy `.env.example` to `.env` (if it exists)
2. Or create `.env` manually with the above variables
3. Set `DB_PASSWORD` to your Supabase password

---

## Database Setup

### Verify Table Exists

Check that your `AviatorRound` table exists in Supabase:

1. Go to Supabase Dashboard: https://app.supabase.com
2. Select your project
3. Go to SQL Editor
4. Query:
   ```sql
   SELECT * FROM "AviatorRound" LIMIT 1;
   ```

### Table Schema

Expected table structure:

```sql
CREATE TABLE IF NOT EXISTS public."AviatorRound" (
    "roundId" bigint generated by default as identity not null,
    "multiplier" real not null,
    "timestamp" timestamp without time zone default CURRENT_TIMESTAMP,
    constraint "AviatorRound_pkey" primary key ("roundId")
);
```

If the table doesn't exist, create it using the SQL above.

---

## Installation & Setup

### Step 1: Install Dependencies (if not already done)

```bash
cd c:\Project
python -m venv venv
venv\Scripts\activate  # Windows
# or: source venv/bin/activate  # Linux/macOS

pip install -r requirements.txt
```

### Step 2: Verify .env File

```bash
# Check that .env exists
type .env  # Windows
# or: cat .env  # Linux/macOS

# Should show:
# DB_HOST=zofojiubrykbtmstfhzx.supabase.co
# DB_PASSWORD=...
# etc.
```

### Step 3: Verify Tesseract Installation

```bash
# Windows
"C:\Program Files\Tesseract-OCR\tesseract.exe" --version

# Linux/macOS
tesseract --version
```

Should output Tesseract version (e.g., `tesseract 5.x.x`)

### Step 4: Test Database Connection

Create a quick test script `test_connection.py`:

```python
import psycopg2
import os
from dotenv import load_dotenv

load_dotenv()

try:
    conn = psycopg2.connect(
        host=os.getenv("DB_HOST"),
        port=int(os.getenv("DB_PORT", "5432")),
        database=os.getenv("DB_NAME"),
        user=os.getenv("DB_USER"),
        password=os.getenv("DB_PASSWORD"),
        sslmode="require"
    )
    print("âœ“ Database connection successful!")
    conn.close()
except Exception as e:
    print(f"âœ— Connection failed: {e}")
```

Run it:
```bash
python test_connection.py
```

---

## Running the Logger

### Quick Start

```bash
cd c:\Project
python standalone_round_logger.py
```

Expected output:

```
=====================================================================
Aviator Round Logger Started
=====================================================================
Screen region: top=506, left=330, width=322, height=76
Poll interval: 30ms
=====================================================================
âœ“ Connected to Supabase database
Monitoring game... Press Ctrl+C to stop

Current: 1.23x (peak: 1.23x) | Rounds logged: 0
Current: 1.45x (peak: 1.45x) | Rounds logged: 0
Current: 2.34x (peak: 2.34x) | Rounds logged: 0
âœ“ Round 1 logged: 2.34x
Current: 1.12x (peak: 1.12x) | Rounds logged: 1
...
```

### Stop the Logger

Press `Ctrl+C` to stop gracefully:

```
^C
Shutdown requested by user
âœ“ Database connection closed
âœ“ Logger stopped. Total rounds logged: 5
=====================================================================
```

---

## Configuration

### Custom Screen Region

If the default region doesn't capture the multiplier correctly:

1. Find the correct region coordinates:
   - Top: Y coordinate of region top edge
   - Left: X coordinate of region left edge
   - Width: Pixel width of region
   - Height: Pixel height of region

2. Edit `standalone_round_logger.py`, change the region in `main()`:

```python
def main():
    logger = AviatorRoundLogger(
        region={
            "top": 506,      # â† Adjust
            "left": 330,     # â† Adjust
            "width": 322,    # â† Adjust
            "height": 76     # â† Adjust
        },
        poll_interval_ms=30
    )
    logger.run()
```

### Polling Interval

Default is 30ms (33 FPS). To adjust:

```python
AviatorRoundLogger(
    poll_interval_ms=50  # Slower: 20 FPS
    # or
    poll_interval_ms=20  # Faster: 50 FPS
)
```

Lower = more CPU usage but faster response
Higher = less CPU usage but might miss multipliers

### Tesseract Path

Script auto-detects Tesseract. If it fails, specify manually:

```python
AviatorRoundLogger(
    tesseract_path=r"C:\Program Files\Tesseract-OCR\tesseract.exe"
)
```

---

## Troubleshooting

### Issue: "âœ— Database connection failed"

**Causes:**
- `.env` file missing or invalid credentials
- Network/firewall blocking Supabase
- Database password incorrect

**Solutions:**
```bash
# 1. Verify .env file exists
ls .env

# 2. Check credentials in .env
cat .env

# 3. Test connection manually
python test_connection.py

# 4. Check Supabase Dashboard
# - Go to https://app.supabase.com
# - Verify project exists
# - Check Database settings â†’ Connection info
```

### Issue: "Tesseract not found"

**Causes:**
- Tesseract not installed
- Installed in non-standard path

**Solutions:**

Windows:
```bash
# Check if installed
"C:\Program Files\Tesseract-OCR\tesseract.exe" --version

# If not found, download and install:
# https://github.com/UB-Mannheim/tesseract/wiki
```

Linux:
```bash
sudo apt-get install tesseract-ocr
```

macOS:
```bash
brew install tesseract
```

### Issue: No multipliers being detected

**Causes:**
- Screen region incorrect
- Game not visible on screen
- OCR confidence too low
- Tesseract misconfigured

**Solutions:**

1. **Verify screen region:**
   ```python
   # Add this to see what's being captured:
   import mss
   import cv2

   with mss.mss() as sct:
       screenshot = sct.grab({"top": 506, "left": 330, "width": 322, "height": 76})
       cv2.imwrite("captured_region.png", screenshot)
   # Open captured_region.png and verify it shows the multiplier display
   ```

2. **Check OCR manually:**
   ```python
   import pytesseract
   import cv2
   from PIL import Image

   img = cv2.imread("captured_region.png")
   text = pytesseract.image_to_string(img)
   print("OCR text:", text)
   ```

3. **Adjust region coordinates:**
   - Use `captured_region.png` to identify correct coordinates
   - Update region in script

### Issue: "No module named 'pytesseract'"

**Solution:**
```bash
# Ensure virtual environment is activated
venv\Scripts\activate  # Windows
# or: source venv/bin/activate  # Linux/macOS

# Reinstall packages
pip install -r requirements.txt
```

### Issue: Database timeout

**Causes:**
- Network connection slow
- Supabase server unreachable

**Solutions:**
```bash
# Test network connectivity
ping zofojiubrykbtmstfhzx.supabase.co

# Try again after network stabilizes
python standalone_round_logger.py
```

The script auto-reconnects if connection is lost.

---

## Monitoring & Logging

### View Database Inserts

In Supabase SQL Editor:

```sql
SELECT * FROM "AviatorRound"
ORDER BY "timestamp" DESC
LIMIT 10;
```

Shows most recent 10 rounds.

### Check Round Count

```sql
SELECT COUNT(*) as total_rounds
FROM "AviatorRound";

SELECT AVG(multiplier) as avg_multiplier
FROM "AviatorRound";
```

### Console Output

The script shows real-time output:

```
Current: 2.34x (peak: 2.34x) | Rounds logged: 5
```

- **Current:** Current multiplier seen on screen
- **Peak:** Highest multiplier in this round
- **Rounds logged:** Total rounds logged so far

---

## Advanced Usage

### Running in Background (Windows)

```bash
# Start in background
start python standalone_round_logger.py

# Or use pythonw.exe for no console window
pythonw standalone_round_logger.py
```

### Running on Startup (Windows)

Create `run_logger.bat`:

```batch
@echo off
cd c:\Project
call venv\Scripts\activate.bat
python standalone_round_logger.py
pause
```

Add to Windows Task Scheduler to run at startup.

### Running on Google VM

For a Google Cloud VM:

1. **Connect via SSH:**
   ```bash
   gcloud compute ssh instance-name --zone=zone-name
   ```

2. **Navigate to project:**
   ```bash
   cd /path/to/Project
   ```

3. **Run in screen session (so it persists after SSH disconnect):**
   ```bash
   screen -S logger
   python standalone_round_logger.py
   # Press Ctrl+A then D to detach
   ```

4. **Reattach later:**
   ```bash
   screen -r logger
   ```

---

## Performance Notes

- **CPU Usage:** ~5-10% (OCR processing)
- **Memory:** ~150-200 MB (Python + OpenCV)
- **Network:** Minimal (1 DB insert per round completion)
- **Accuracy:** >95% with proper region configuration

---

## Data Retention

The `AviatorRound` table will continuously grow with each round.

### Cleanup (Optional)

If you want to delete old data:

```sql
-- Delete rounds older than 7 days
DELETE FROM "AviatorRound"
WHERE "timestamp" < NOW() - INTERVAL '7 days';

-- Delete all data (careful!)
DELETE FROM "AviatorRound";

-- Truncate table (faster)
TRUNCATE TABLE "AviatorRound" RESTART IDENTITY;
```

---

## Next Steps

1. âœ… Install dependencies
2. âœ… Verify .env file
3. âœ… Verify Tesseract installation
4. âœ… Run the logger: `python standalone_round_logger.py`
5. âœ… Watch for round logging
6. âœ… Verify data in Supabase dashboard

---

## Support & Debugging

### Get Full Logs

To see detailed logs, modify the script:

```python
# Change logging level
logging.basicConfig(
    level=logging.DEBUG,  # Changed from INFO
    format='%(asctime)s - %(levelname)s - %(message)s'
)
```

### Common Messages

| Message | Meaning |
|---------|---------|
| `âœ“ Connected to Supabase` | Database connection successful |
| `âœ“ Round N logged: X.XXx` | Round successfully inserted |
| `âœ— Database insert failed` | Connection or query error (auto-reconnects) |
| `Current: X.XXx` | Real-time multiplier reading |
| `Tesseract not found` | OCR engine not installed |

---

## Summary

**What it does:**
1. Captures multiplier from Aviator game screen
2. Reads value via Tesseract OCR
3. Detects when round completes
4. Inserts peak multiplier to Supabase

**Output:**
- Console: Real-time multiplier readings
- Database: One row per completed round
- Logging: Detailed info/error messages

**Configuration:**
- Screen region: Adjustable
- Poll interval: Adjustable (30ms default)
- Database: Automatic reconnection

Happy logging! ðŸš€

---

For questions or issues, check the troubleshooting section above or review the script code comments in `standalone_round_logger.py`.
